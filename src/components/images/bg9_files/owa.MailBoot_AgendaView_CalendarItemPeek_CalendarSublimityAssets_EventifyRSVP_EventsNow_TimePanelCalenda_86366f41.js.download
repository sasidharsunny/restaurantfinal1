self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AgendaView~CalendarItemPeek~CalendarSublimityAssets~EventifyRSVP~EventsNow~TimePanelCalenda~86366f41.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[83],{1758:function(e,t,n){"use strict";var r=n(3),a=Object(r.action)("updateLoadedDateRange",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),c=Object(r.action)("updateCalendarEventLoadStates",(function(e,t){return{calendarIds:e,eventsCacheLockId:t}})),o=Object(r.action)("resetCalendarEventLoadStates",(function(e){return{eventsCacheLockId:e}})),i=Object(r.action)("updateLoadState",(function(e,t){return{eventsCacheLockId:t,loadState:e}})),u=Object(r.action)("initializeScenario",(function(e){return{eventsCacheLockId:e}})),d=Object(r.action)("updateIsInitializingCalendarEventsLoader",(function(e,t){return{eventsCacheLockId:t,isInitializingCalendarEventsLoader:e}})),s=n(0),f=n(1846),v=n(1359);function l(e){var t=Object(v.p)(e);return Object(s.__assign)(Object(s.__assign)({},t),{getOrderedEvents:function(t,n){return function(e,t,n){var r=Object(v.p)(n).getCalendarEventsForDateRange,a=[];return e.forEach((function(e){a.push.apply(a,Object(s.__spread)(r(e,t)))})),a.sort(f.a)}(t,n,e)}})}var b=n(2085);var h=n(20),O={scenarios:new h.ObservableMap},j=Object(r.createStore)("EventsLoadedStore",O),L=n(177),_=n(784);function g(e){return Object(L.d)(e)&&!Object(L.c)(e)}function I(e){return Object(L.d)(e)&&Object(L.c)(e)}function C(e){return void 0===e&&(e=function(){return!0}),function(t,n){var r=Object(s.__read)(n,2),a=r[0],c=r[1];return e([a,c])&&t.push(a),t}}function p(e){return function(t){var n=Object(s.__read)(t,2);n[0];return n[1]===e}}var k=n(269);function E(e){return F(e).eventsCacheLockId}function w(e,t){return Object(L.d)(t)?g(t)?N(e).get(t):Object(_.d)(t):"Loading"}function m(e){return x(e).map((function(t){return w(e,t)}))}function R(e){return j().scenarios.has(e)?F(e).scenarioLoadState:"DoesNotExist"}function D(e){return F(e).loadedDateRange}function S(e,t){return P(e).reduce(C(p(t)),[])}function F(e){var t=j().scenarios.get(e);return t||(Object(k.p)("GetScenarioDataError",{eventsCacheLockId:e}),{eventsCacheLockId:e,loadedDateRange:null,scenarioLoadState:"DoesNotExist",calendarEventsLoadState:new h.ObservableMap({}),isInitializingCalendarEventsLoader:!1})}function z(e,t){var n=t||D(e),r=function(e){return x(e).filter(g).map(L.x)}(e),a=E(e),c=r?l(a).getOrderedEvents(r,n):[];return Object(b.a)()||(c=c.filter((function(e){return"Decline"!==e.ResponseType}))),c}function N(e){return F(e).calendarEventsLoadState}function P(e){return Object(s.__spread)(N(e).entries())}function x(e){return Object(s.__spread)(N(e).keys())}Object(r.mutator)(a,(function(e){var t=e.eventsCacheLockId,n=e.dateRange;F(t).loadedDateRange=n})),Object(r.mutator)(i,(function(e){var t=e.eventsCacheLockId,n=e.loadState;F(t).scenarioLoadState=n})),Object(r.mutator)(d,(function(e){var t=e.eventsCacheLockId,n=e.isInitializingCalendarEventsLoader;F(t).isInitializingCalendarEventsLoader=n})),Object(r.mutator)(u,(function(e){var t=e.eventsCacheLockId;j().scenarios.get(t)||j().scenarios.set(t,{eventsCacheLockId:t,loadedDateRange:null,scenarioLoadState:"Loading",calendarEventsLoadState:new h.ObservableMap({}),isInitializingCalendarEventsLoader:!0})})),Object(r.mutator)(v.v,(function(e){var t=e.calendarId,n=e.loadingState,r=function(e){var t=Object(s.__spread)(j().scenarios.entries()).filter((function(t){var n=Object(s.__read)(t,2);n[0];return n[1].eventsCacheLockId===e}));return t.length>0?{value:!0,eventsCacheLockId:t[0][0]}:{value:!1}}(e.lockId);if(r.value){var a=N(r.eventsCacheLockId);t&&a.has(t.id)&&a.set(t.id,n)}})),Object(r.mutator)(c,(function(e){var t=e.calendarIds,n=e.eventsCacheLockId,r=N(n);t.forEach((function(e){r.has(e)||r.set(e,"NotLoaded")})),x(n).forEach((function(e){t.some((function(t){return t===e}))||r.delete(e)}))})),Object(r.mutator)(o,(function(e){var t=e.eventsCacheLockId,n=N(t);x(t).forEach((function(e){n.set(e,"NotLoaded")}))}));var y=Object(r.action)("initializeCalendarEventsLoader",(function(e,t,n){return{calendarIds:e,dateRange:t,eventsCacheLockId:n}})),A=Object(r.action)("calendarEventsLoaderInitialized",(function(e){return{eventsCacheLockId:e}})),M=Object(r.action)("updateCalendarIds",(function(e,t){return{calendarIds:e,eventsCacheLockId:t}})),U=Object(r.action)("onCalendarIdsUpdated",(function(e){return{eventsCacheLockId:e}})),q=Object(r.action)("onDateRangeUpdated",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),H=Object(r.action)("loadFullEvent",(function(e,t,n){return{eventsCacheLockId:e,id:t,parentFolderId:n}})),$=Object(r.action)("updateDateRange",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),G=Object(r.action)("expandDateRange",(function(e,t){return{numberOfDays:e,eventsCacheLockId:t}})),T=n(9);function B(e,t){return null===t||!Object(T.Hb)(e.start,t.start)||!Object(T.Hb)(e.end,t.end)}var J=n(59),K=function(e,t,n){return e&&0!==e.length?function(e,t,n){var r=this;var a=E(n),c=Object(v.q)(a),o=e.map((function(e){return c.fetchCalendarEventsForDateRange(e,t)})),i=o.every((function(e){return null!==e.events})),u=new Promise((function(t){return Object(s.__awaiter)(r,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all(o.map((function(e){return e.fetchPromise})))];case 1:return r.sent(),e.forEach((function(e){return c.subscribeNotifications(e)})),[3,3];case 2:return n=r.sent(),J.g.warn("loadEvents: Exception occured: "+n.message),[3,3];case 3:return t(),[2]}}))}))}));return{canFetchAllEventsFromLocal:i,fetchPromise:u}}(e,t,n):{canFetchAllEventsFromLocal:!1,fetchPromise:new Promise((function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,e()]}))}))}))}};function Q(e,t,n){return Object(s.__awaiter)(this,void 0,void 0,(function(){var r,a,c,o,u;return Object(s.__generator)(this,(function(d){switch(d.label){case 0:return(r=t.filter(g)).length>0?(a=r.map(L.x),c=K(a,n,e),o=c.canFetchAllEventsFromLocal,u=c.fetchPromise,o||i("Fetching",e),[4,u]):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))}var V=function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e?[4,Promise.all(e.filter(I).map(_.c).map((function(e){return e.catch(W)})))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))};function W(e){return J.g.warn("Failed to update folderId:\n"+e),Promise.resolve()}function X(e){o(e),a(null,e)}function Y(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,r,o,u;return Object(s.__generator)(this,(function(d){switch(d.label){case 0:return n=t.calendarIds,r=t.dateRange,c(n,e),o=S(e,"NotLoaded"),V(o),u=D(e),B(r,u)||0!==o.length?(i("Loading",e),B(r,u)&&X(e),[4,Q(e,n,r)]):[3,2];case 1:d.sent(),a(r,e),i("Loaded",e),U(e),d.label=2;case 2:return[2]}}))}))}Object(r.orchestrator)(y,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:if(t=e.eventsCacheLockId,n=e.calendarIds,r=e.dateRange,"DoesNotExist"===R(t))u(t);else if(function(e){return F(e).isInitializingCalendarEventsLoader}(t))return[2];return[4,Y(t,{calendarIds:n,dateRange:r})];case 1:return a.sent(),A(t),d(!1,t),[2]}}))}))})),Object(r.orchestrator)(M,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,r,a;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return t=e.calendarIds,n=e.eventsCacheLockId,c(t,n),r=S(n,"NotLoaded"),V(r),a=D(n),0===r.length?[3,2]:(i("Loading",n),[4,Q(n,r,a)]);case 1:o.sent(),i("Loaded",n),U(n),o.label=2;case 2:return[2]}}))}))}));var Z=n(2782),ee=(Object(r.orchestrator)($,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(c){switch(c.label){case 0:return t=e.dateRange,n=e.eventsCacheLockId,r=D(n),B(t,r)?(i("Loading",n),X(n),[4,Object(Z.c)((function(){return Q(n,x(n),t)}),"UpdateDateRange_"+n)]):[3,2];case 1:c.sent().isCurrent&&(a(t,n),i("Loaded",n),q(t,n)),c.label=2;case 2:return[2]}}))}))})),Object(r.orchestrator)(G,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,r,c;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return t=e.eventsCacheLockId,n=e.numberOfDays,r=D(t),c={start:r.start,end:Object(T.e)(r.end,n)},i("Loading",t),[4,Q(t,x(t),c)];case 1:return o.sent(),a(c,t),i("Loaded",t),[2]}}))}))})),Object(r.orchestrator)(H,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,r,a;return Object(s.__generator)(this,(function(c){return t=e.eventsCacheLockId,n=e.parentFolderId,r=e.id,a=E(t),(0,Object(v.q)(a).fetchFullCalendarEvent)(r,n?n.Id:null,void 0,void 0,{fetchSource:t}),[2]}))}))})),n(675));function te(){var e=this;Object(s.__spread)(j().scenarios.entries()).reduce((function(e,t){var n=Object(s.__read)(t,2),r=n[0],a=(n[1],P(r).reduce(C(p("NotLoaded")),[]));return a&&a.length>0&&e.push({eventsCacheLockId:r,calendarIds:a}),e}),[]).forEach((function(t){return Object(s.__awaiter)(e,void 0,void 0,(function(){var e,n,r;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:return e=t.eventsCacheLockId,n=t.calendarIds,(r=D(e))?(i("Loading",e),[4,Q(e,n,r)]):[3,2];case 1:a.sent(),i("Loaded",e),a.label=2;case 2:return[2]}}))}))}))}Object(r.orchestrator)(ee.c,te),Object(r.orchestrator)(_.a,te);n.d(t,"h",(function(){return y})),n.d(t,"a",(function(){return A})),n.d(t,"l",(function(){return M})),n.d(t,"j",(function(){return U})),n.d(t,"k",(function(){return q})),n.d(t,"i",(function(){return H})),n.d(t,"m",(function(){return $})),n.d(t,"b",(function(){return G})),n.d(t,"e",(function(){return w})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return R})),n.d(t,"g",(function(){return D})),n.d(t,"c",(function(){return z}))}}]);
//# sourceMappingURL=owa.MailBoot~AgendaView~CalendarItemPeek~CalendarSublimityAssets~EventifyRSVP~EventsNow~TimePanelCalenda~86366f41.js.map
self.scriptsLoaded['owa.MailBoot~AgendaView~CalendarItemPeek~CalendarSublimityAssets~EventifyRSVP~EventsNow~TimePanelCalenda~86366f41.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AgendaView~CalendarItemPeek~CalendarSublimityAssets~EventifyRSVP~EventsNow~TimePanelCalenda~86366f41.js'] = (new Date()).getTime();