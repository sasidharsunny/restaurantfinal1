self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~Translation.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[763],{2181:function(e,t,a){"use strict";var n=a(3),r=a(362);t.a=Object(n.createStore)("TranslationStore",{sessionId:Object(r.a)(),localeOfSupportedLanguageMap:null,supportedLanguageMap:null,isUserLocaleSupported:!1,userLanguageName:null,userLanguageTag:null,settings:{translationMode:null,targetLanguage:null,excludedLanguages:[],initialized:!1}})()},9168:function(e,t,a){"use strict";a.r(t);var n,r=a(0),s=a(2181),u=a(30),i=a(321),o="/ows/v1/OutlookCloudSettings/settings/account",g="translator_translation_mode",c="translator_target_language",l="translator_known_languages";function d(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return n||(n=Object(i.b)(o+"?settingname=\n            "+g+",\n            "+c+",\n            "+l,null,!1,null,!0).then((function(e){var t={translationMode:null,targetLanguage:null,excludedLanguages:null,initialized:!1};return e.forEach((function(e){switch(e.name){case g:t.translationMode=parseInt(e.value,10);break;case c:t.targetLanguage=e.value;break;case l:var a=JSON.parse(e.value);t.excludedLanguages=[],a.forEach((function(e){return t.excludedLanguages.push(e.languageTag)}))}})),t})).catch((function(e){throw n=null,e}))),[2,n]}))}))}function f(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,Object(i.c)(o,e,null,!0,{Accept:"application/json","x-overridetimestamp":!0})]}))}))}var p=a(3),L=Object(p.mutatorAction)("setTranslationSettings",(function(e){s.a.settings.translationMode=e.translationMode,s.a.settings.targetLanguage=e.targetLanguage,s.a.settings.excludedLanguages=e.excludedLanguages,s.a.settings.initialized=!0})),h=a(83),O=a(1318);function v(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return(t=Object(O.d)(O.a.Translation)).translationMode=Object(h.i)("tra-useOcsSettings")?e.translationMode+16:e.translationMode,t.targetLanguage=e.targetLanguage,t.excludedLanguages=e.excludedLanguages,[4,O.e.importAndExecute(O.a.Translation,t)];case 1:return a.sent(),[2]}}))}))}var b=a(337),x=a(269);function S(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,a,n,i,o,g,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t=[],a=Object(u.a)().SessionSettings.UserEmailAddress,s.a.settings.translationMode!==e.translationMode&&(M(t,e.translationMode,a),Object(x.p)("InlineTranslationChangeTranslationMode",[],{cosmosOnlyData:e.translationMode.toString()})),n=!1,s.a.settings.targetLanguage!==e.targetLanguage&&(_(t,e.targetLanguage,a),e.excludedLanguages.indexOf(e.targetLanguage)<0&&(e.excludedLanguages.push(e.targetLanguage),n=!0),Object(x.p)("InlineTranslationChangeTargetLanguage",[],{cosmosOnlyData:e.targetLanguage?e.targetLanguage:"none"})),e.excludedLanguages.forEach((function(e){s.a.settings.excludedLanguages.includes(e)||(n=!0,Object(x.p)("InlineTranslationOptOutOfLanguage",[],{cosmosOnlyData:e}))})),s.a.settings.excludedLanguages.forEach((function(t){e.excludedLanguages.includes(t)||(n=!0,Object(x.p)("InlineTranslationRemoveOptOutOfLanguage",[],{cosmosOnlyData:t}))})),n&&j(t,e.excludedLanguages,a),!(t.length>0))return[3,7];i="SavingOcsSettings",r.label=1;case 1:return r.trys.push([1,5,,6]),Object(h.i)("tra-useOcsSettings")?[4,f(t)]:[3,3];case 2:if(!(o=r.sent())||!Object(b.a)(o.status))throw new Error("Failed to save settings in OCS");r.label=3;case 3:return i="SavingOoSettings",[4,v(e)];case 4:return r.sent(),[3,6];case 5:return g=r.sent(),c=g instanceof Error?g:new Error("Error while "+i),new x.a("InlineTranslationUpdateSettings").endWithError("ServerError",c),[2,!1];case 6:L(e),r.label=7;case 7:return[2,!0]}}))}))}function M(e,t,a){e.push({name:g,value:t,type:"Int",scope:a})}function _(e,t,a){var n=null==t?"":t;e.push({name:c,value:n,type:"String",scope:a})}function j(e,t,a){var n=[];t.forEach((function(e){return n.push({languageTag:e})})),e.push({name:l,value:JSON.stringify(n),type:"JSON",scope:a})}function w(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return s.a.settings.excludedLanguages&&e&&!s.a.settings.excludedLanguages.includes(e)?((t={translationMode:s.a.settings.translationMode,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0}).excludedLanguages.push(e),[4,S(t)]):[2];case 1:return a.sent(),[2]}}))}))}var m="-",T=4;function A(e){if(0===(e=e.toLowerCase()).lastIndexOf("zh-",0))switch(e){case"zh-cht":case"zh-hant":case"zh-hk":case"zh-tw":return"zh-cht";default:return"zh-chs"}var t=e.indexOf(m,1);if(-1===t)return e;var a=e.indexOf(m,t+m.length);return-1===a&&(a=e.length),a-t==m.length+T&&(t=a),e.substring(0,t)}function E(e){return!(!s.a.supportedLanguageMap||!e)&&s.a.supportedLanguageMap.has(e)}function y(e,t){void 0===t&&(t=null);var a=A(e);if(!E(a))return!1;if(null!=t){var n=A(t);return!!E(n)&&a!==n}return!0}var G=a(3803);var z="https://ogma.osi.office.net",I="/TradukoApi/api/v1.0/translateContentArray",N="/TradukoApi/api/v1.0/supportedLanguages",R="/TradukoApi/api/v1.0/detectLanguage",q="ows/api/v1/translation/translateText",U="ows/api/v1/translation/getSupportedLanguages";function H(e){return U+"?clientLocale="+e}var D=a(2),k=s.a.sessionId,W=Object(D.m)(),C=Object(D.n)();function J(e,t){return!!(t&&k&&W&&C)&&(e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.setRequestHeader("x-translator-sid",k),e.setRequestHeader("x-translator-cross-sid",k),e.setRequestHeader("x-translator-cid",t),e.setRequestHeader("x-translator-user-id",W),e.setRequestHeader("x-translator-client-version",C),e.setRequestHeader("x-translator-client-app","Outlook"),e.setRequestHeader("x-translator-client-type","Browser"),!0)}var P=a(96),F=s.a.sessionId,X=Object(P.h)().SessionSettings.UserPuid,$=Object(D.n)();function B(e){if(e&&F&&X&&$)return{"x-translator-sid":F,"x-translator-cross-sid":F,"x-translator-cid":e,"x-translator-user-id":X,"x-translator-client-version":$}}var K=3e4;function Q(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(a){return[2,new Promise((function(a,n){Object(h.i)("rp-inlineTranslation-UseOWS")?function(e,t,a,n){Object(r.__awaiter)(this,void 0,void 0,(function(){var s,u,o,g,c,l,d,f;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(s=B(t)))return[3,5];u=A(e),o=!1,g=setTimeout((function(){o=!0,n("Request timed out")}),K),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.b)(H(u),t,!1,s,!0)];case 2:return c=r.sent(),o||(clearTimeout(g),(l=V(c))?a(l):n("OWS OGMA returned invalid response: "+c)),[3,4];case 3:return d=r.sent(),f=(null==d?void 0:d.message)?d.message:"",n("getSupportedLanguagesOWS failed:"+f),[3,4];case 4:return[3,6];case 5:n("getSupportedLanguagesOWS failed: headers were not set."),r.label=6;case 6:return[2]}}))}))}(e,t,a,n):function(e,t,a,n){var r=new XMLHttpRequest;r.timeout=K,r.onload=function(){if(200===r.status)if(this.responseText){var e=V(JSON.parse(this.responseText));e?a(e):n("OGMA returned invalid response: "+this.response)}else n("OGMA returned invalid response: "+this.response);else n("OGMA failed to retrieve supported languages: "+this.response)},r.onerror=function(){n("OGMA call failed: "+this.response)},r.ontimeout=function(){n("OGMA call timed out")};var s=A(e);r.open("GET",function(e){return""+z+N+"?clientLocale="+e}(s)),J(r,t)?r.send():n("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,a,n)}))]}))}))}function V(e){try{var t=new Map;return e.forEach((function(e){t.set(e.LanguageTag,e)})),t}catch(e){return null}}function Y(e,t){if(e.length!=t.length)return!0;for(var a=0;a<e.length;a++)if(!t.includes(e[a]))return!0;return!1}function Z(e){if(!e||!e.excludedLanguages||e.excludedLanguages.length<=0)return!1;for(var t=!1,a=[],n=0;n<e.excludedLanguages.length;n++){var r=e.excludedLanguages[n];r&&s.a.supportedLanguageMap.has(r)?a.push(r):t=!0}return!!t&&(e.excludedLanguages=a,!0)}var ee=Object(p.mutatorAction)("setSupportedLanguageMap",(function(e,t){var a=A(e),n=t.get(a);n?(s.a.localeOfSupportedLanguageMap=e,s.a.userLanguageName=n.LanguageName,s.a.userLanguageTag=a,s.a.supportedLanguageMap=t,s.a.isUserLocaleSupported=y(e)):s.a.isUserLocaleSupported=!1})),te=a(362),ae=15e3,ne=0,re=ae;function se(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,a,n,i,o,g,c,l,p,b;return Object(r.__generator)(this,(function(S){switch(S.label){case 0:if(e=Object(u.a)().SessionSettings.UserCulture,t=Date.now(),Object(h.i)("rp-inlineTranslationAutomatic")||s.a.settings.translationMode!==G.a.Automatic||(s.a.settings.translationMode=G.a.Suggest),!Object(h.i)("rp-inlineTranslation-targetLanguage")&&s.a.settings.targetLanguage&&(s.a.settings.targetLanguage=""),e===s.a.localeOfSupportedLanguageMap&&s.a.settings.initialized||!(0===ne||t>ne+re))return[3,11];a=null,n=Object(te.a)(),i=new x.a("InlineTranslationGetSupportedLanguages"),S.label=1;case 1:return S.trys.push([1,9,,10]),null!=s.a.supportedLanguageMap?[3,3]:[4,Q(e,n)];case 2:a=S.sent(),ee(e,a),E(s.a.settings.targetLanguage)||(s.a.settings.targetLanguage=""),S.label=3;case 3:return s.a.settings.initialized?[3,8]:[4,O.f.import()];case 4:return[4,S.sent()(O.a.Translation)];case 5:return o=S.sent(),g=function(e){if(e.translationMode>G.a.Suggest)return e.translationMode=e.translationMode-16,(e.translationMode<G.a.SuggestAutomatic||e.translationMode>G.a.Suggest)&&(e.translationMode=G.a.SuggestAutomatic),!1;return!0}(o),c={translationMode:o.translationMode,targetLanguage:null!=o.targetLanguage?o.targetLanguage:"",excludedLanguages:null==o.excludedLanguages?[]:Object(r.__spread)(o.excludedLanguages),initialized:!1},Object(h.i)("tra-useOcsSettings")?[4,d()]:[3,7];case 6:l=S.sent(),function(e,t,a){var n=!1,r=!1,i=[],o=Object(u.a)().SessionSettings.UserEmailAddress;Z(e)&&(n=!0),Z(t)&&(r=!0),null==t.translationMode||a&&t.translationMode!==e.translationMode?M(i,e.translationMode,o):t.translationMode!==e.translationMode&&(e.translationMode=t.translationMode,n=!0),e.targetLanguage||(e.targetLanguage=s.a.userLanguageTag,n=!0),!t.targetLanguage||a&&t.targetLanguage!==e.targetLanguage?_(i,e.targetLanguage,o):t.targetLanguage!==e.targetLanguage&&(e.targetLanguage=t.targetLanguage,n=!0),null==t.excludedLanguages||a&&Y(e.excludedLanguages,t.excludedLanguages)?(e.targetLanguage&&e.excludedLanguages.indexOf(e.targetLanguage)<0&&(e.excludedLanguages.push(e.targetLanguage),n=!0),j(i,e.excludedLanguages,o)):(r&&j(i,e.excludedLanguages,o),Y(e.excludedLanguages,t.excludedLanguages)&&(e.excludedLanguages=t.excludedLanguages,n=!0)),i.length>0&&f(i),(n||a)&&v(e)}(c,l,g),S.label=7;case 7:L(c),S.label=8;case 8:return ne=0,re=ae,i.end(),[3,10];case 9:throw p=S.sent(),b=new Error("[InlineTranslation] Failed to initialize translation. Error:"+p+" | cid:"+n),ne=t,re*=2,i.endWithError("ServerError",b),p;case 10:return[2,!0];case 11:return[2,!1]}}))}))}function ue(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,se()];case 1:return e.sent(),[2,s.a.supportedLanguageMap]}}))}))}function ie(){return s.a.localeOfSupportedLanguageMap}function oe(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(a){return[2,new Promise((function(a,n){var r=new XMLHttpRequest;r.onload=function(){if(200===r.status){var e=JSON.parse(this.responseText);e?a(e):n("OGMA returned invalid response: "+this.response)}else n("OGMA failed to detect email language: "+this.response)},r.onerror=function(){n("OGMA call failed: "+this.response)},r.open("POST",""+z+R),J(r,t)?r.send(JSON.stringify(e)):n("getOgmaDetectedLanguage failed: headers were not set. ")}))]}))}))}var ge=1e4;function ce(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,a,n,s,u,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=Object(te.a)(),a=null,n=new x.a("InlineTranslationGetDetectedLanguage"),r.label=1;case 1:return r.trys.push([1,3,,4]),(s=e.join(" ")).length>ge&&(s=s.substring(0,ge)),[4,oe(s,t)];case 2:return a=r.sent(),n.end(),[3,4];case 3:return u=r.sent(),i=new Error("[InlineTranslation] getOgmaDetectedLanguage failed. Error:"+u+" | cid:"+t),n.endWithError("ServerError",i),[3,4];case 4:return[2,a]}}))}))}function le(e){return s.a.supportedLanguageMap.has(e)?s.a.supportedLanguageMap.get(e).LanguageName:null}function de(){return s.a.userLanguageName}function fe(){return s.a.userLanguageTag}function pe(){return s.a.settings.targetLanguage?le(s.a.settings.targetLanguage):de()}function Le(){return s.a.settings.targetLanguage?s.a.settings.targetLanguage:s.a.userLanguageTag}function he(){return s.a.settings}function Oe(){return s.a.isUserLocaleSupported}var ve=3e4;function be(e,t,a){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,new Promise((function(n,s){Object(h.i)("rp-inlineTranslation-UseOWS")?function(e,t,a,n,s){Object(r.__awaiter)(this,void 0,void 0,(function(){var u,o,g,c,l;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(u=B(a)))return[3,5];o=!1,g=setTimeout((function(){o=!0,s("Request timed out")}),ve),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.d)((d=t,q+"?toLang="+d),e,a,!1,u,!0)];case 2:return c=r.sent(),o||(clearTimeout(g),null!=c?n(xe(c)):s("OGMA returned invalid response: "+c)),[3,4];case 3:return l=r.sent(),s("translateTextOWS failed:"+l.message),[3,4];case 4:return[3,6];case 5:s("translateTextOWS failed: headers were not set."),r.label=6;case 6:return[2]}var d}))}))}(e,t,a,n,s):function(e,t,a,n,r){var s=new XMLHttpRequest;s.timeout=ve,s.onload=function(){if(200===s.status){var e=JSON.parse(this.responseText);null!=e?n(xe(e)):r("OGMA returned invalid response: "+this.response)}else r("OGMA failed to translate messaage: "+this.response)},s.onerror=function(){r("OGMA call failed: "+this.response)},s.ontimeout=function(){r("OGMA call timed out")},s.open("POST",function(e){return""+z+I+"?fromLang=&toLang="+e}(t)),J(s,a)?s.send(function(e){var t=[];return e.forEach((function(e){var a={Data:e,DataType:"html"};t.push(a)})),JSON.stringify(t)}(e)):r("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,a,n,s)}))]}))}))}function xe(e){var t=[];return e.forEach((function(e){t.push(e.TranslatedText)})),t}function Se(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,S({translationMode:e,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0})];case 1:return t.sent(),[2]}}))}))}a.d(t,"addExcludedLanguage",(function(){return w})),a.d(t,"checkCanTranslate",(function(){return y})),a.d(t,"initSupportedLanguages",(function(){return se})),a.d(t,"initAndGetSupportedLanguageMap",(function(){return ue})),a.d(t,"getLocaleOfSupportedLanguageMap",(function(){return ie})),a.d(t,"getOgmaSupportedLanguageTag",(function(){return A})),a.d(t,"getDetectedLanguage",(function(){return ce})),a.d(t,"getLanguageNameFromTag",(function(){return le})),a.d(t,"getUserLanguageName",(function(){return de})),a.d(t,"getUserLanguageTag",(function(){return fe})),a.d(t,"getTargetLanguageName",(function(){return pe})),a.d(t,"getTargetLanguageTag",(function(){return Le})),a.d(t,"getTranslationSettings",(function(){return he})),a.d(t,"getIsUserLocaleSupported",(function(){return Oe})),a.d(t,"translateText",(function(){return be})),a.d(t,"updateTranslationMode",(function(){return Se})),a.d(t,"updateTranslationSettings",(function(){return S}))}}]);
//# sourceMappingURL=owa.MailBoot~Translation.js.map
self.scriptsLoaded['owa.MailBoot~Translation.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~Translation.js'] = (new Date()).getTime();