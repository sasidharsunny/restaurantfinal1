self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.31.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[31],{1624:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return l})),n.d(t,"h",(function(){return v}));var r=n(0),c=n(2305),a=n(2341);function o(e,t){var n=Object(c.a)().calendarFolderEvents.get(t);return n?n.locksInfo.get(e):null}function u(e){var t=f(e);return t?Object(r.__spread)(t.locksInfo.entries()).reduce(Object(a.c)(),[]):[]}function i(e){var t=f(e);return t?Object(r.__spread)(t.locksInfo.entries()).reduce(Object(a.d)(),{}):{}}function s(e,t){var n=f(e);return n?Object(r.__spread)(n.locksInfo.entries()).reduce(Object(a.e)(Object(a.m)(t)),[]):[]}function d(){var e=Object(c.a)();return Object(r.__spread)(e.calendarFolderEvents.keys())}function f(e){return Object(c.a)().calendarFolderEvents.get(e)||null}function l(e){var t=f(e);return(null==t?void 0:t.events)?Object(r.__spread)(t.events.values()):[]}function v(e){return!!f(e)}},2305:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(3),c=n(20),a={calendarFolderEvents:new c.ObservableMap,fullItemsMruMap:new c.ObservableMap,calendarFolderWorkingHours:new c.ObservableMap},o=Object(r.createStore)("calendarEventsStore",a)},2341:function(e,t,n){"use strict";var r=n(0);function c(e,t){t.locksInfo.get(e)||t.locksInfo.set(e,{lockedDateRange:null,lockedEvents:{}})}var a=n(5716),o=n(20);function u(e,t,n){void 0===n&&(n=!1);t.Key;var c,a=Object(r.__rest)(t,["Key"]);i(e,n?a:(c=a,Object.keys(c).reduce((function(e,t){return void 0!==c[t]&&(e[t]=c[t]),e}),{})))}function i(e,t){if(e!==t){var n=Array.isArray(e)||Object(o.isObservableArray)(e),c=Array.isArray(t)||Object(o.isObservableArray)(t);if(n||c){var u=e,d=t;if(!e&&c)return d.length>0?d:u;if(!t&&n)return u.length>0&&u.splice(0),u;if(n&&c){if(u.length===d.length&&u.length>0)for(var f=0;f<u.length;f++)s(u[f])?Object(a.a)(u[f],d[f],i):u[f]=d[f];else u.length!==d.length&&(u.splice(0),u.push.apply(u,Object(r.__spread)(d)));return u}return d}return s(e)&&s(t)?Object(a.a)(e,t,i):void 0}}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}var d=n(9),f=n(3124);function l(e,t,n){void 0===n&&(n=!1);var r=function(e,t,n){for(var r=[],c=0;c<e.length;c++){var a=e[c],o=t.get(a.Key);o?(u(o,a,n),r.push(o)):r.push(a)}return r}(e,t,n);return r.forEach((function(e){t.set(e.Key,e)})),function(e){e.sort((function(e,t){return Object(d.p)(e.Start,t.Start)}))}(r),Object(f.a)({lockId:"",updateMessage:"Upserted "+r.length+" items in the cache"}),r}function v(e,t,n,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),c(t,n);var i=n.events;if(a){var s=i.get(e.Key);s&&(u(s,e,o),e=s)}var d=Object(r.__read)(l([e],i,o),1)[0];return n.locksInfo.get(t).lockedEvents[e.Key]=!0,Object(f.a)({lockId:t,updateMessage:"Event with startTime "+d.Start+" added to the lock"}),d}var g=n(534);function b(e,t){for(var n={start:e.Start,end:e.End},r=0;r<t.length;r++)if(0===Object(g.j)(t[r],n,!0))return!0;return!1}function j(e,t,n){var r=n.dateRangesToRetain,c=n.eventsToRetain;return function(e,t,n){var r=t.dateRangesToRetain,c=t.eventsToRetain,a=[];return e.forEach((function(e,t){var o=b(e,[n]),u=b(e,r),i=c[e.Key]||u;o&&!i&&a.push(e)})),a.forEach((function(t){e.delete(t.Key)})),a}(t,{dateRangesToRetain:r.filter((function(t){return 0===Object(g.j)(t,e,!0)})),eventsToRetain:c},e)}function k(e,t,n){var r=[];return t.forEach((function(t){-1!==e.indexOf(t.Key)&&function(e,t){var n=t.dateRangesToRetain,r=t.eventsToRetain;return!b(e,n)&&!r[e.Key]}(t,n)&&r.push(t)})),r.forEach((function(e){t.delete(e.Key)})),r}function O(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&Object.keys(o.lockedEvents).forEach((function(e){return t[e]=!0})),t}}function h(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&o.lockedDateRange&&t.push(o.lockedDateRange),t}}function p(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&t.push(a),t}}function R(e){return function(t){var n=Object(r.__read)(t,2),c=(n[0],n[1]);return c.lockedDateRange&&0===Object(g.j)(c.lockedDateRange,e,!1)}}var E,_=function(e){return function(t){return Object(r.__read)(t,1)[0]!==e}};function I(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange,u=a.lockedEvents,i=Object(r.__spread)(n.locksInfo.entries()).reduce(h(e!==E.EventIds?_(t):function(){return!0}),[]),s=Object(r.__spread)(n.locksInfo.entries()).reduce(O(e!==E.DateRange?_(t):function(){return!0}),{});!o||e!==E.All&&e!==E.DateRange||(j(o,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedDateRange=null);var d=Object.keys(u);d.length>0&&(e===E.All||e===E.EventIds)&&(k(d,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedEvents={})}!function(e){e[e.All=0]="All",e[e.DateRange=1]="DateRange",e[e.EventIds=2]="EventIds"}(E||(E={}));var y=n(59);function D(e,t,n,r){c(n,r);var a,o,u=r.locksInfo.get(n).lockedDateRange,i=u?u.start+" - "+u.end:"null";u&&(a=u,o=e,0==Object(g.j)(a,o,!0)||function(e,t){return 1==(Object(d.p)(e.start,t.start)<0?Object(d.w)(t.start,e.end):Object(d.w)(e.start,t.end))}(a,o))&&!Object(g.c)(e,u,!0)?Object(g.c)(u,e,!0)?y.g.info("[addEventsForLock]: Date range in lock "+n+" already contains the range to be added."):u=Object(g.f)(u,e):(y.g.info('[addEventsForLock] Replacing all items in cache for lock "'+n+'". Date range: '+e.start+" - "+e.end),I(E.DateRange,n,r),u=e);var s=l(t,r.events);return r.locksInfo.get(n).lockedDateRange=u,y.g.info('[addEvents] New range in cache for lock "'+n+'": '+u.start+" - "+u.end),Object(f.a)({lockId:n,updateMessage:s.length+" events added to the lock. Previous locked daterange: "+i+". New locked daterange: "+u.start+" - "+u.end}),s}function w(e,t,n){var r=t.events.size,c=[];t.events.forEach((function(e,t){var r={start:e.Start,end:e.End};n.some((function(e){return 0===Object(g.j)(r,e,!0)}))&&c.push(t)})),c.forEach((function(e){t.events.delete(e)})),e.forEach((function(e){t.events.set(e.Key,e)})),Object(f.a)({lockId:"",updateMessage:"Replaced "+c.length+" items of initial "+r+" from cache with "+e.length+" items"})}function T(e,t,n){if(0===e.length)return[];c(t,n);var a=n.locksInfo.get(t);e=e.filter((function(e){return a.lockedEvents[e]}));var o=Object(r.__spread)(n.locksInfo.entries()).reduce(h(),[]),u=Object(r.__spread)(n.locksInfo.entries()).reduce(O(_(t)),{}),i=k(e,n.events,{dateRangesToRetain:o,eventsToRetain:u});return e.forEach((function(e){delete a.lockedEvents[e]})),i}function m(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange;if(o&&!Object(g.c)(e,a.lockedDateRange,!0)){Object(f.a)({lockId:t,updateMessage:"Now evicting events in cache except for events in date range "+e.start+" - "+e.end+". Current locked cache range: "+o.start+" - "+o.end});var u=Object(r.__spread)(n.locksInfo.entries()).reduce(h(_(t)),[e]),i=Object(r.__spread)(n.locksInfo.entries()).reduce(O(),{}),s=j(o,n.events,{dateRangesToRetain:u,eventsToRetain:i});y.g.info("[owa-events-cache:evictEventsExceptInDateRangeForLock] Evicted "+s.length+" events for lock '"+t+"'"),Object(g.c)(o,e,!0)?a.lockedDateRange=Object(r.__assign)({},e):a.lockedDateRange=function(e,t){var n=-1===Object(d.p)(e.start,t.start),r=1===Object(d.p)(e.end,t.end),c=e.start,a=e.end;n&&(c=t.start);r&&(a=t.end);return{start:c,end:a}}(e,o),Object(f.a)({lockId:t,updateMessage:"Evicted "+s.length+" events for lock. New locked cache range: "+o.start+" - "+o.end})}}function K(e,t){var n=t.events,c=[];return n.forEach((function(t,n){e(t)&&c.push(t)})),c.forEach((function(e){n.delete(e.Key)})),function(e,t){Object(r.__spread)(t.locksInfo.keys()).forEach((function(n){var r=t.locksInfo.get(n);e.forEach((function(e){return delete r.lockedEvents[e.Key]}))}))}(c,t),Object(f.a)({lockId:"",updateMessage:"Unloaded "+c.length+" items from cache"}),c.reverse()}function M(e,t){I(E.All,e,t),t.locksInfo.delete(e)}function A(e,t){var n=[];return t.forEach((function(t){var r={start:t.Start,end:t.End};0===Object(g.j)(e,r,!0)&&n.push(t)})),n}var S=n(4);function F(e,t,n){var r=n&&n.locksInfo.get(t)?n.locksInfo.get(t).lockedDateRange:null;if(null!=r&&Object(g.c)(r,e,!0)){var c=A(e,n.events);if(Object(S.d)("debugEventsCache")){var a=c?c.length:"no";Object(f.a)({lockId:t,updateMessage:"Returning "+a+" items from cache for date range: "+e.start+" - "+e.end})}return c}return null}function L(e,t,n){var r=n.locksInfo.get(t)||{},c=r.lockedDateRange,a=void 0===c?null:c,o=r.lockedEvents,u=void 0===o?[]:o;return null===a&&0===Object.keys(u).length?e.map((function(e){return null})):function(e,t,n){var r=n.locksInfo.get(t),c=r.lockedDateRange,a=r.lockedEvents,o={};return e.forEach((function(e){var t=n.events.get(e);if(t){var r={start:t.Start,end:t.End};(!!c&&0===Object(g.j)(c,r,!0)||a[t.Key])&&(o[t.Key]=t)}})),e.map((function(e){return o[e]||null}))}(e,t,n)}var N=0;function U(e){var t=e||"events_cache_lock_"+N;return N++,t}function x(){return{events:new o.ObservableMap,locksInfo:new o.ObservableMap}}n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return D})),n.d(t,"r",(function(){return l})),n.d(t,"p",(function(){return w})),n.d(t,"i",(function(){return T})),n.d(t,"h",(function(){return m})),n.d(t,"o",(function(){return K})),n.d(t,"n",(function(){return M})),n.d(t,"q",(function(){return u})),n.d(t,"k",(function(){return F})),n.d(t,"j",(function(){return A})),n.d(t,"l",(function(){return L})),n.d(t,"g",(function(){return U})),n.d(t,"f",(function(){return x})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return O})),n.d(t,"e",(function(){return p})),n.d(t,"m",(function(){return R}))},3124:function(e,t,n){"use strict";var r=n(7422),c=n(83),a=function(e){Object(c.i)("cal-cacheDiagnostics")&&setTimeout((function(){return Object(r.a)(e)}),0)};n.d(t,"a",(function(){return a}))},5716:function(e,t,n){"use strict";var r=n(1593),c=n(1885),a=n(1447),o=Object(c.a)((function(e,t,n,c){Object(r.a)(t,Object(a.a)(t),e,c)}));t.a=o},7422:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),c=Object(r.action)("logCacheUpdateForDiagnostics",(function(e){return{cacheUpdateLog:e}}))}}]);
//# sourceMappingURL=owa.31.js.map
self.scriptsLoaded['owa.31.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.31.js'] = (new Date()).getTime();