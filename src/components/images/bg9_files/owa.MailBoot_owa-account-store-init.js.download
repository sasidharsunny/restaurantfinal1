self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[795],{1262:function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(96),c=t(669),u=t(388),i=t(1347),s=t(295),a=t(3151),d=t(440);var l={};function b(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,b,f;return Object(r.__generator)(this,(function(O){return t=e.userIdentity,Object(o.i)(t)?[2,Promise.resolve()]:(b=l[t])?[2,b.requestPromise]:(f=function(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,l,b,f,O,v,p,j,S;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=e.userIdentity,l=e.accountProviderType,r.label=1;case 1:return r.trys.push([1,6,,7]),Object(u.d)(e),b=Object(s.d)(t),[4,Object(i.b)(Object(d.a)(b))];case 2:return f=r.sent(),O=Object(u.s)(t),f.headers&&O?[4,Object(a.a)(f)]:[3,4];case 3:return v=r.sent(),Object(o.x)(v,t),Object(c.c)(t,l),[3,5];case 4:p=f.headers?"Account invalid ":"Missing headers",Object(c.b)(t,n,l,p),r.label=5;case 5:return[3,7];case 6:return j=r.sent(),S="Exception"+j,Object(c.b)(t,n,l,S),[3,7];case 7:return[2]}}))}))}(e,n),l[t]={requestPromise:f},[2,f])}))}))}var f=t(2346),O=t(3),v=t(270),p=t(83),j=t(9),S=t(269);function w(e){return e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=30?{lowerBoundSeconds:0,upperBoundSeconds:30}:e<=60?{lowerBoundSeconds:30,upperBoundSeconds:60}:e<=300?{lowerBoundSeconds:60,upperBoundSeconds:300}:e<=600?{lowerBoundSeconds:300,upperBoundSeconds:600}:e<=1800?{lowerBoundSeconds:600,upperBoundSeconds:1800}:e<=3600?{lowerBoundSeconds:1800,upperBoundSeconds:3600}:e<=21600?{lowerBoundSeconds:3600,upperBoundSeconds:21600}:e<=43200?{lowerBoundSeconds:21600,upperBoundSeconds:43200}:e<=86400?{lowerBoundSeconds:43200,upperBoundSeconds:86400}:e>86400?{lowerBoundSeconds:86400,upperBoundSeconds:null}:{lowerBoundSeconds:null,upperBoundSeconds:null}}function A(e){switch(e.providerType){case f.c.Msa:case f.c.MsaInt:return!0;case f.c.Google:return Object(p.i)("cal-addCalendar-google");case f.c.TeamSnap:return!1;case f.c.ICloud:return Object(p.i)("cal-addCalendar-iCloud");default:return Object(v.a)(e.providerType)}}Object(O.orchestrator)(c.a,(function(){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var e,n,t;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return Object(u.h)()==u.a.AccountsLoadSuccessful?[2]:(Object(u.w)(u.a.None),[4,f.e.importAndExecute()]);case 1:return e=o.sent(),n=e,t=null==e?void 0:e.isSuccess,n.ConnectedAccountResponses&&"function"==typeof n.ConnectedAccountResponses.filter?[4,Promise.all(n.ConnectedAccountResponses.filter(A).map((function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var n,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=function(e){switch(e){case f.c.Msa:return"Outlook";case f.c.Google:return"Google";case f.c.ICloud:return"ICloud";default:return Object(v.a)(e)}}(e.providerType),o=parseInt(e.token.expiresIn),Object(S.p)("hasConnectedAccount",{tokenExpiry:o,type_1:n,isNewCloudCacheMailboxProvisioned_2:e.newCloudCacheMailboxProvisioned,tokenExpiryLowerBound_3:w(o).lowerBoundSeconds,tokenExpirtyUpperBound_4:w(o).upperBoundSeconds},{isCore:!0}),[4,b({userIdentity:e.userAccount.emailAddress,accountId:e.userAccount.id,accountUniqueId:e.userAccount.accountUniqueId,anchorMailbox:e.userAccount.routingHint,token:e.token.accessToken,tokenExpiry:Object(j.j)(Object(j.Pb)(),o),accountProviderType:n,accountState:u.b.Valid},!1)];case 1:return r.sent(),Object(u.l)(e.userAccount.emailAddress)!=u.b.Valid&&(t=!1),[2]}}))}))})))]:[3,3];case 2:o.sent(),o.label=3;case 3:return Object(u.e)(t),[2]}}))}))})),Object(O.orchestrator)(c.d,(function(e){var n=e.userIdentity;return Object(r.__awaiter)(void 0,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return Object(u.u)(n),Object(o.w)(n),Object(s.f)(n),[2]}))}))}));var h=t(1405);Object(O.orchestrator)(h.b,(function(e){b(Object(u.k)(e.userIdentity),!0)})),Object(O.orchestrator)(c.b,(function(e){var n=e.userIdentity,t=e.isRetry,r=e.accountProvider,o=e.error;(Object(S.p)("owaAccountStoreInitializationFailed",{error:o,accountProvider:r,isRetry:t},{isCore:!0}),t)?Object(u.x)(n,u.b.FailedToInitializeOWAConfig):b(Object(u.k)(n),!0)})),t.d(n,"initializeOwaAccountsStore",(function(){return c.a})),t.d(n,"removeOWAConnectedAccount",(function(){return c.d})),t.d(n,"owaAccountStoreInitializationFailed",(function(){return c.b})),t.d(n,"initializeOwaConnectedAccount",(function(){return b}))},1346:function(e,n,t){"use strict";function r(e,n){Object.keys(n).forEach((function(t){return e.set(t,n[t])}))}function o(e){var n=null!=e?e:{headers:new Headers};return n.datapoint=n.datapoint||{},n.datapoint.mailbox="Default",n}t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o}))},1347:function(e,n,t){"use strict";var r=t(0),o=t(1405),c=t(388),u=t(662),i=t(269),s=t(9),a="X-AnchorMailbox",d="Authorization",l="X-OwaWebSessionType",b="X-OWA-ExplicitLogonUser";function f(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,f,O,v,p;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t={},f=Object(c.k)(e)){if(f.accountState==c.b.AccessRevoked)return[2,null];if(f.accountState==c.b.AccountDeprovisioned||f.accountState==c.b.AccountNotFound)return Object(c.c)(f.accountState,f.accountProviderType),[2,null]}return n?(t[a]=n,t[b]=n):f&&(t[a]=f.anchorMailbox),f?(O=f.token,!(v=Object(u.g)(f.tokenExpiry))&&O?[3,2]:(Object(i.p)("getAndUpdateAccessToken",{tokenExpiry:Object(s.y)(f.tokenExpiry,Object(s.Pb)()),isTokenExpired_1:v,isTokenInvalid_2:!O},{isCore:!0}),[4,o.a.importAndExecute(f.accountId,e)])):[3,3];case 1:(O=r.sent())||(O=""),r.label=2;case 2:p=void 0,"Outlook"==f.accountProviderType?(p='MSAuth1.0 usertoken="'+O+'", type="MSACT"',t[l]=1..toString()):"Google"!=f.accountProviderType&&"ICloud"!=f.accountProviderType||(p="Bearer "+O,t[l]=2..toString()),t[d]=p,r.label=3;case 3:return[2,t]}}))}))}var O=t(1346),v=t(59);function p(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(O.a)(),o=t,[4,j(e,n)];case 1:return o.headers=r.sent(),t.authNeededOnUnAuthorized=!1,t.datapoint=t.datapoint||{},t.datapoint.mailbox="Connected",[2,t]}}))}))}function j(e,n){var t;return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return o=n&&(null===(t=e.headers)||void 0===t?void 0:t.set)?new Headers(e.headers):new Headers,[4,f(e.mailboxInfo.userIdentity,S(e.mailboxInfo.type,e.mailboxInfo.mailboxSmtpAddress)?e.mailboxInfo.mailboxSmtpAddress:null)];case 1:return c=r.sent(),Object(O.b)(o,c),[2,o]}}))}))}function S(e,n){var t="GroupMailbox"==e||"TeamsMailbox"==e||"SharedMailbox"==e||"PublicMailbox"==e;return t&&null==n&&v.d("getHeadersForConnectedAccount: mailboxSmtpAddress should be passed for Group or Teams or Shared or Public Mbx request"),t}t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return p})),t.d(n,"c",(function(){return S}))},1348:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(3),o=Object(r.action)("triggerReInitializeAccount",(function(e){return{userIdentity:e}}))},1405:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(77),o=t(1348);t.d(n,"b",(function(){return o.a}));var c=new r.c((function(){return t.e(1149).then(t.bind(null,1664))})),u=new r.a(c,(function(e){return e.getAndUpdateAccessToken}))},2112:function(e,n,t){"use strict";var r;t.d(n,"a",(function(){return r})),function(e){e[e.AccessRevoked=0]="AccessRevoked",e[e.AccountNotFound=1]="AccountNotFound",e[e.InvalidClient=2]="InvalidClient",e[e.InvalidCredentials=3]="InvalidCredentials",e[e.InvalidProvider=4]="InvalidProvider",e[e.MailboxDeprovisioned=5]="MailboxDeprovisioned",e[e.Transient=6]="Transient",e[e.PermissionDenied=7]="PermissionDenied",e[e.UserCancelled=8]="UserCancelled",e[e.AadAuth=9]="AadAuth",e[e.Unknown=10]="Unknown",e[e.ProviderUnavailable=11]="ProviderUnavailable"}(r||(r={}))},2346:function(e,n,t){"use strict";var r=t(77),o=t(2437),c=t(2112),u=t(0),i=t(3055);function s(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(i.a)(e)];case 1:return[2,n.sent()]}}))}))}t.d(n,"g",(function(){return d})),t.d(n,"e",(function(){return l})),t.d(n,"h",(function(){return b})),t.d(n,"f",(function(){return f})),t.d(n,"i",(function(){return O})),t.d(n,"c",(function(){return o.b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return c.a})),t.d(n,"d",(function(){return s}));var a=new r.c((function(){return Promise.all([t.e(0),t.e(2),t.e(3),t.e(4),t.e(7),t.e(14),t.e(23),t.e(796)]).then(t.bind(null,16691))})),d=new r.a(a,(function(e){return e.linkAccountAndGetAccessToken})),l=new r.a(a,(function(e){return e.getAllConnectedAccounts})),b=(new r.a(a,(function(e){return e.getConnectedAccount})),new r.a(a,(function(e){return e.addConnectedAccount})),new r.a(a,(function(e){return e.removeConnectedAccount}))),f=(new r.a(a,(function(e){return e.refreshConnectedAccountAccessToken})),new r.a(a,(function(e){return e.idpResponseHandler}))),O=new r.a(a,(function(e){return e.setAddConnectedAccountHandler}));"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.lazyIdpResponseHandler=f)},2437:function(e,n,t){"use strict";var r,o;t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o})),function(e){e.Msa="Msa",e.TeamSnap="TeamSnap",e.MsaInt="MsaInt",e.Google="Google",e.ICloud="ICloud"}(r||(r={})),function(e){e.Active="Active",e.Revoked="Revoked",e.Error="Error"}(o||(o={}))},295:function(e,n,t){"use strict";var r=t(30),o=t(0),c=t(96),u=t(83);function i(e){var n=Object(c.i)(e);return n&&n.SessionSettings?0===n.SessionSettings.WebSessionType?Object(u.i)("doc-attachment-routingKeyAadSmtp")?"SMTP:":"":"MSA:":"no-routing-key:"}var s=t(59);function a(e,n,t){var r,c;if(t)try{for(var u=Object(o.__values)(t),i=u.next();!i.done;i=u.next()){var s=i.value;if(!d(e,s))return s}}catch(e){r={error:e}}finally{try{i&&!i.done&&(c=u.return)&&c.call(u)}finally{if(r)throw r.error}}return n&&n.length>0?n[0]:"NoResolvableAddress@invalid.outlook.com"}function d(e,n){return("outlook_"+e+"@outlook.com").toLowerCase()===n.toLowerCase()}function l(){var e=function(){var e=Object(r.a)();if(!e||!e.SessionSettings)return s.d("SessionSettings not available"),"no-routing-key";var n=e.SessionSettings.UserEmailAddress;if(0===e.SessionSettings.WebSessionType)return i()+n;if(Object(u.i)("doc-attachment-routingKeyPuid"))return"PUID:"+e.SessionSettings.UserPuid+"@"+e.SessionSettings.TenantGuid;if(e.SessionSettings.IsShadowMailbox)return i()+e.SessionSettings.LogonEmailAddress;if(d(e.HexCID,e.SessionSettings.UserEmailAddress))return i()+a(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses);return i()+n}();return e=encodeURIComponent(e)}function b(){var e=Object(r.a)();if(!e||!e.SessionSettings)return s.d("SessionSettings not available"),"no-mailbox-id";var n=e.SessionSettings.UserEmailAddress;return Object(u.i)("doc-attachment-usePrimarySmtpAddressForMailboxId")?n:(e.SessionSettings.IsShadowMailbox?n=e.SessionSettings.LogonEmailAddress:d(e.HexCID,e.SessionSettings.UserEmailAddress)&&(n=a(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses)),n)}var f=t(747),O=t(623);function v(e){var n=Object(O.a)().userMailboxInfoMap;n&&n.delete(e)}function p(e,n){return e===n||null!=e&&null!=n&&e.Id===n.Id}t.d(n,"c",(function(){return b})),t.d(n,"d",(function(){return f.a})),t.d(n,"f",(function(){return v})),t.d(n,"e",(function(){return p})),t.d(n,"a",(function(){return l})),t.d(n,"b",(function(){return i}))},3055:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t(0),o=t(12),c=t(321),u=t(2112),i=t(337),s=t(3056),a="ows/beta/ConnectedAccounts/refreshtoken/{0}";function d(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(c.c)(Object(o.c)(a,e),null,void 0,!0).then((function(e){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),t=n,Object(s.a)("refreshToken_serviceResponse",e,t),Object(i.a)(e.status)?[2,{ConnectedAccountResponse:n,isSuccess:!0}]:400==e.status||404==e.status?[2,{errorResponse:n,isSuccess:!1}]:(429==e.status&&(o=Number(e.headers.get("RetryAfter").slice(-2)),Object(s.b)(o,"refreshAccountToken")),[2,{errorResponse:{error:u.a[u.a.Transient]},isSuccess:!1}])}}))}))})).catch((function(e){return{errorResponse:{error:u.a[u.a.Unknown],errorDescription:JSON.stringify(e)},isSuccess:!1}}))];case 1:return[2,t.sent()]}}))}))}},3056:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(269),o=t(337);function c(e,n,t){var c=Object(o.a)(n.status);Object(r.p)(e,{isSuccess_1:c,status_2:n.status,errorCode:c?null:JSON.stringify(null==t?void 0:t.error),errorDescription:c?null:JSON.stringify(null==t?void 0:t.errorDescription)},{isCore:!0})}function u(e,n){var t={lowerBoundSeconds:null,upperBoundSeconds:null};t=e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=1?{lowerBoundSeconds:0,upperBoundSeconds:1}:e<=2?{lowerBoundSeconds:1,upperBoundSeconds:2}:e<=5?{lowerBoundSeconds:2,upperBoundSeconds:5}:e<=10?{lowerBoundSeconds:5,upperBoundSeconds:10}:e<=30?{lowerBoundSeconds:10,upperBoundSeconds:30}:e>60?{lowerBoundSeconds:30,upperBoundSeconds:60}:{lowerBoundSeconds:null,upperBoundSeconds:null},Object(r.p)("ConnectedAccounts429Error",{retryAfterLowerBound_1:t.lowerBoundSeconds,retryAfterUpperBound_2:t.upperBoundSeconds,apiName_3:n})}},3151:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(29);function o(e){return Object(r.a)("GetOwaUserConfiguration",{},e)}},321:function(e,n,t){"use strict";t.d(n,"d",(function(){return c})),t.d(n,"c",(function(){return u})),t.d(n,"e",(function(){return i})),t.d(n,"b",(function(){return s})),t.d(n,"a",(function(){return a})),t.d(n,"f",(function(){return d}));var r=t(77),o=new r.c((function(){return Promise.all([t.e(1),t.e(23),t.e(860)]).then(t.bind(null,944))})),c=new r.a(o,(function(e){return e.makePostRequest})).importAndExecute,u=new r.a(o,(function(e){return e.makePatchRequest})).importAndExecute,i=new r.a(o,(function(e){return e.makePutRequest})).importAndExecute,s=new r.a(o,(function(e){return e.makeGetRequest})).importAndExecute,a=new r.a(o,(function(e){return e.makeDeleteRequest})).importAndExecute,d=new r.a(o,(function(e){return e.sendOwsPrimeRequest})).importAndExecute},337:function(e,n,t){"use strict";var r=t(726);t.d(n,"a",(function(){return r.a}))},440:function(e,n,t){"use strict";var r=t(0);function o(e,n){return e?Object(r.__assign)({mailboxInfo:e},n):null!=n?n:void 0}t.d(n,"a",(function(){return o}))},623:function(e,n,t){"use strict";var r=t(3),o=t(20);n.a=Object(r.createStore)("OWAClientIdStore",{userMailboxInfoMap:new o.ObservableMap})},662:function(e,n,t){"use strict";var r=t(3),o=Object(r.action)("initializeOwaObservableDateTime"),c=Object(r.action)("observableNowChanged"),u=Object(r.action)("observableTodayChanged"),i=t(9),s=t(20),a=Object(r.createStore)("ObservableDateTime",{now:0,today:0}),d=Object(s.computed)((function(){return Object(i.lc)(a().now)})),l=function(){return d.get()},b=Object(s.computed)((function(){return Object(i.lc)(a().today)})),f=function(){return b.get()},O=function(e){return Object(i.Gb)(e,l())},v=function(e){return Object(i.Eb)(e,l())},p=function(e){return S(e,i.Gb)},j=function(e){return S(e,i.Hb)},S=function(e,n){return n(Object(i.Wb)(Object(i.lc)(e)),f())};function w(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.Z;var r=function(e){return Object(i.Mb)(t,Object(i.e)(n,-e),n)};if(r(3))return i.hb;if(r(30))return i.gb;return i.X}(n,f())(n)}function A(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.S;return i.T}(n,f())(n)}function h(e){return e?function(e,n){var t=Object(i.Wb)(e);return Object(i.Ib)(t,n)?Object(i.Z)(e):g(t,n,2)?Object(i.kb)(e):g(t,n,7)?Object(i.H)(Object(i.ab)(e),Object(i.Z)(e)):Object(i.H)(Object(i.J)(e),Object(i.Z)(e))}(Object(i.lc)(e),f()):""}function g(e,n,t){return Object(i.Mb)(e,Object(i.e)(n,-t),n)}var m=Object(r.action)("updateTimes"),y=Object(r.action)("setNow"),_=Object(r.action)("setToday",(function(e){return{today:e}}));Object(r.mutator)(y,(function(){a().now=Object(i.jc)()})),Object(r.mutator)(_,(function(e){var n=e.today;a().today=n}));var x=t(34),I=t(128);Object(r.orchestrator)(o,(function(){m();var e=Object(i.Pb)(),n=Object(i.Yb)(Object(i.h)(e,1)),t=Object(i.w)(n,e);setTimeout((function(){return setInterval(m,x.g)}),t)})),Object(r.orchestrator)(I.l,(function(){m()})),Object(r.orchestrator)(m,(function(){y();var e=Object(i.zb)(Object(i.kc)()),n=a().today!=e;n&&_(e),c(),n&&u()})),t.d(n,"d",(function(){return o})),t.d(n,"j",(function(){return c})),t.d(n,"l",(function(){return u})),t.d(n,"i",(function(){return l})),t.d(n,"k",(function(){return f})),t.d(n,"g",(function(){return O})),t.d(n,"e",(function(){return v})),t.d(n,"f",(function(){return p})),t.d(n,"h",(function(){return j})),t.d(n,"a",(function(){return w})),t.d(n,"b",(function(){return A})),t.d(n,"c",(function(){return h}))},726:function(e,n,t){"use strict";function r(e){return e>=200&&e<300}t.d(n,"a",(function(){return r}))},747:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(96),o=t(623);function c(e){var n=Object(o.a)().userMailboxInfoMap;if(!n||!n.get(e)){var t=!1;e&&(t=e!=Object(r.b)());var c={type:"UserMailbox",userIdentity:t?e:Object(r.b)(),mailboxSmtpAddress:t?e:Object(r.c)()};return n.set(e,c),c}return n.get(e)}}}]);
//# sourceMappingURL=owa.MailBoot~owa-account-store-init.js.map
self.scriptsLoaded['owa.MailBoot~owa-account-store-init.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();