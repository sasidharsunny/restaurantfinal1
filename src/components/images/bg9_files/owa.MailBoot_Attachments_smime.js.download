self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~Attachments~smime.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[217],{10001:function(t,e,n){"use strict";var a=n(0),r=n(2759),c=n(337);e.a=function(t){return Object(a.__awaiter)(void 0,void 0,void 0,(function(){var e,n;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return(e={}).method="GET",e.headers=new Headers,e.headers.set(r.c,r.d),e.headers.set("Content-Type","application/json;charset=utf-8"),[4,fetch(t,e)];case 1:if(n=a.sent(),!Object(c.a)(n.status))throw new Error("The data package cannot be retrieved. StatusCode: "+n.status);return[4,n.text()];case 2:return[2,a.sent()]}}))}))}},10003:function(t,e,n){"use strict";var a=n(3420),r=n(5383),c=n(3958),o=n(6866),i=n(5369),s=n(1733),u=n(5599),d=n(4964),m=n(1379),h=n(285),l=n(1681);e.a=Object(h.action)("updateSmimeAttachment")((function(t,e,n,h,b){Object(o.a)(n,b)&&Object(d.a)(t.attachmentId);var f=Object(l.a)(n);if(n.AttachmentId=e,n.Name=h.Name||n.Name,n.Size=h.Size||n.Size,n.ContentType=h.ContentType||n.ContentType,n.__type=h.__type||n.__type,2===f?n.MimeContent=h.MimeContent:0===f&&(n.Content=h.Content),n.IsInline&&(n.ContentId=h.ContentId||n.ContentId),Object(u.a)([{attachmentId:e,attachment:n}],!1),t.attachmentId=e,Object(i.a)(t))Object(r.a)(t,1);else{var O=Object(m.a)(e);Object(s.g)(t,!1),Object(c.a)(t,0),Object(a.a)(t,O,!1,[])}}))},10004:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(0);function r(t){return Object(a.__assign)({__type:"AttachmentId:#Exchange"},t)}},13467:function(t){t.exports=JSON.parse('{"a":"Uia","b":"Via"}')},1640:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(270);function r(t){switch(t){case 0:return"ReadOnlyAccess";case 1:return"ReadOnlyPlusAttachmentsBlockedAccess";case 2:return null;default:return Object(a.a)(t)}}},1784:function(t,e,n){"use strict";var a=n(1384);function r(){var t=Object(a.a)();return t.ConditionalAccessDirectFileAccessOnPrivateComputersBlocked||t.ConditionalAccessDirectFileAccessOnPublicComputersBlocked?t.ConditionalAccessWacViewingOnPrivateComputersBlocked||t.ConditionalAccessWacViewingOnPublicComputersBlocked?[1]:[0]:[]}var c=n(1640),o=n(1553);function i(){return r()}function s(t){return(t&&t.length>0&&function(t){return t.some((function(t){return!((e=t).IsInline&&!Object(o.a)(e));var e}))}(t)?r():[]).map(c.a)}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}))},1938:function(t,e,n){"use strict";var a=n(77),r=[0,1],c=n(2136),o=n(2101),i=n(12),s=n(270),u=n(1389);function d(t){switch(t){case"ReadOnlyPlusAttachmentsBlockedAccess":return{key:"access_control_info_bar",source:u.c.Compose,rank:u.b.Error,message:Object(i.b)(o.a),messageParts:[Object(i.b)(o.a),m()],color:u.a.Red};case"ReadOnlyAccess":return{key:"access_control_info_bar_check",source:u.c.Compose,rank:u.b.Error,message:Object(i.b)(c.b),messageParts:[Object(i.b)(c.b),m()],color:u.a.Red};default:return Object(s.a)(t)}}function m(){return{text:Object(i.b)(c.a),action:function(){window.open("https://docs.microsoft.com/en-us/intune-user-help/use-managed-devices-to-get-work-done","_blank")}}}var h=n(1784),l=n(1640),b=n(0),f=n(83),O=n(1384);function p(){var t=Object(O.a)();if(Object(f.i)("fwk-devTools")){if(Object(f.i)("doc-attachment-CA-readOnlyAccessIssues"))return Object(b.__assign)(Object(b.__assign)({},t),{DirectFileAccessOnPrivateComputersEnabled:!1,DirectFileAccessOnPublicComputersEnabled:!1,WacViewingOnPrivateComputersEnabled:!0,WacViewingOnPublicComputersEnabled:!0});if(Object(f.i)("doc-attachment-CA-readOnlyPlusAttachmentsBlocked"))return Object(b.__assign)(Object(b.__assign)({},t),{DirectFileAccessOnPrivateComputersEnabled:!1,DirectFileAccessOnPublicComputersEnabled:!1,WacViewingOnPrivateComputersEnabled:!1,WacViewingOnPublicComputersEnabled:!1})}return t}function I(){var t=p();return t.DirectFileAccessOnPrivateComputersEnabled&&t.DirectFileAccessOnPublicComputersEnabled?2:t.WacViewingOnPrivateComputersEnabled&&t.WacViewingOnPublicComputersEnabled?0:1}n.d(e,"g",(function(){return j})),n.d(e,"a",(function(){return r})),n.d(e,"f",(function(){return d})),n.d(e,"b",(function(){return h.a})),n.d(e,"e",(function(){return l.a})),n.d(e,"d",(function(){return I})),n.d(e,"c",(function(){return p}));var w=new a.c((function(){return n.e(1570).then(n.bind(null,16451))})),j=new a.b(w,(function(t){return t.getAccessIssuesForAttachments}))},2101:function(t){t.exports=JSON.parse('{"a":"cca"}')},2136:function(t){t.exports=JSON.parse('{"a":"aca","b":"bca"}')},4311:function(t,e,n){"use strict";var a=n(0),r=function(t){function e(e,n,a){var r=t.call(this,e)||this;return r.errorCode=n,r.errorContext=a,r}return Object(a.__extends)(e,t),e}(Error);e.a=r},4921:function(t){t.exports=JSON.parse('{"a":"Wia"}')},4965:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return c}));var a="application/octet-stream",r=1024,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},6866:function(t,e,n){"use strict";function a(t,e){var n,a=null===(n=null==t?void 0:t.AttachmentId)||void 0===n?void 0:n.RootItemId;return a&&e&&a===e.Id}n.d(e,"a",(function(){return a}))},6868:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(4965);function r(t){if(!t)return t;var e=t.toLowerCase().charCodeAt(0);if(e>=97&&e<=122&&-1===t.indexOf("#")&&-1===t.indexOf("-"))try{return atob(t)}catch(t){}for(var n="",r=0,c=function(){var e=t.charAt(r++);switch(e){case"\r":case"\n":return c();default:return e}};r<t.length;){var o=a.a.indexOf(c()),i=a.a.indexOf(c()),s=a.a.indexOf(c()),u=a.a.indexOf(c()),d=o<<2|i>>4,m=(15&i)<<4|s>>2,h=(3&s)<<6|u;n+=String.fromCharCode(d),64!=s&&(n+=String.fromCharCode(m)),64!=u&&(n+=String.fromCharCode(h))}return n}},7279:function(t,e,n){"use strict";var a=n(8513),r=n(12),c=n(1612),o=n(4375),i=n(59),s=n(0),u=function(t){if(!t)return t;if(0===t.indexOf("data:")){var e=t.indexOf(";base64,");return t.substr(e+";base64,".length)}return t},d=n(269),m=n(10003),h=n(6866),l=n(1379),b=n(4561),f=n(6868),O=n(4921),p=n(10004),I=n(29),w=n(723);var j=n(2106),v=n(10001),g=n(4311),A=n(295),C=n(1923),_=function(t,e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var n,a,r,c;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:n=new d.a("FetchAttachmentContent",{isCore:!0}),a=Object(C.a)(Object(s.__assign)({mailboxInfo:Object(A.d)()},t),0),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Object(v.a)(a+(e?"&asDataUri=true":""))];case 2:return r=o.sent(),n.end(),[2,r];case 3:throw c=o.sent(),i.d("SmimeTraceError: FetchAttachmentContent failed. URL: "+a),n.endWithError("ServerError",c),new g.a(c.message,11);case 4:return[2]}}))}))},S=n(13467),D=n(1811),y=n(1681),E=n(1503),P=n(1471);var F=function(){function t(t,e,n){var a=this;this.attachmentWellViewState=t,this.parentItemId=e,this.infoBar=n,this.downloadQueue=[],this.downloadFailures=[],this.deleteQueue=[],this.onFinishPromise=new Promise((function(t,e){a.onFinish=function(e){t(e)}}))}return t.prototype.enqueueSmimeAttachmentDownload=function(t,e){var n=this;void 0===e&&(e=null),t.map((function(t){var a={attachmentState:t,attachment:Object(l.a)(t.attachmentId),onAttachmentDownloaded:e};n.downloadQueue.push(a)})),this.startProcessIfNotStarted()},t.prototype.deleteSmimeAttachment=function(t,e){var n=1===t.attachmentType,a=n?0===t.status:0===t.ongoingAction;n||Object(D.A)(t,3,6),a&&this.currentDownloadItem&&this.currentDownloadItem.attachmentState.attachmentId!==t.attachmentId&&(i.g.info("Attachment: Removing attachment: TempId= "+t.attachmentId+" from S/MIME download queue"),this.removeRelatedItemFromDownloadQueue(t,this.downloadQueue)),this.deleteQueue.push({attachmentState:t,onAttachmentDeleted:e}),this.startProcessIfNotStarted()},t.prototype.startProcessIfNotStarted=function(){this.isInProgress||(this.datapoint=new d.a("SmimeAttachmentQueueManager"),this.isInProgress=!0,this.processNextAttachment())},t.prototype.processNextAttachment=function(){var t;return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,n,a,r,c,o,O,v,g,A,C,S,D,F,x,M,k,N,W,Q,T,V;return Object(s.__generator)(this,(function(B){switch(B.label){case 0:return 0==this.deleteQueue.length?[3,1]:(e=this.deleteQueue.shift(),c=e.attachmentState,n=e.onAttachmentDeleted,a=Object(l.a)(c.attachmentId),Object(b.a)(this.attachmentWellViewState,c),null==n||n(this.parentItemId,a.model.AttachmentId,a.model),this.processNextAttachment(),[3,19]);case 1:if(0===this.downloadQueue.length)return[3,18];this.currentDownloadItem=this.downloadQueue.shift(),r=this.currentDownloadItem,c=r.attachmentState,o=r.attachment,O=r.onAttachmentDownloaded,v=Object(y.a)(o.model),g=o.model,A=void 0,B.label=2;case 2:return B.trys.push([2,15,16,17]),C=this.getAttachmentId(o.model,this.parentItemId),A=Object(s.__assign)({},g),2!==v?[3,9]:(null===(t=(S=g).Item)||void 0===t?void 0:t.MimeContent)?(A.MimeContent=Object(f.a)(S.Item.MimeContent.Value),[3,8]):[3,3];case 3:return g.MimeContent?[3,8]:(null==C?void 0:C.Id)?[4,_(C)]:[3,5];case 4:return F=B.sent(),[3,7];case 5:return[4,(R={itemId:this.getItemId(o.model)},void 0===R.itemId||R.itemId.__type||(R.itemId=Object(w.a)(R.itemId)),Object(I.a)("GetMime",R,U))];case 6:F=B.sent(),B.label=7;case 7:D=F,A.__type=P.b,A.MimeContent=D,Object(d.p)("SmimeAttachmentDownloadDatapoint",{isMailDownload:!0},{isCore:!0}),B.label=8;case 8:return[3,14];case 9:return 0!==v?[3,13]:g.Content?[3,11]:[4,_(C,!0)];case 10:return x=B.sent(),A.__type=P.a,A.Content=u(x),Object(d.p)("SmimeAttachmentDownloadDatapoint",{isFileDownload:!0},{isCore:!0}),[3,12];case 11:A=Object(s.__assign)({},g),B.label=12;case 12:return[3,14];case 13:throw 1===v?new Error("S/MIME: Unsupported reference attachment"):new Error("S/MIME: Unsupported attachment type");case 14:return M=g.AttachmentId,Object(E.d)(g)&&Object(h.a)(g,this.parentItemId)||(M=Object(s.__assign)(Object(s.__assign)({},Object(p.a)({Id:Object(j.e)()})),{mailboxInfo:this.parentItemId.mailboxInfo})),null==O||O(o.model),Object(m.a)(c,M,g,A,this.parentItemId),[3,17];case 15:return"S/MIME: Unsupported reference attachment"!==(k=B.sent()).message&&i.d("SmimeTraceError: "+k.message),N=this.currentDownloadItem.attachment.model.IsInline,W=this.currentDownloadItem.attachment,Q=W.attachmentClass,T=W.type,Object(d.p)("SmimeAttachmentDownloadDatapoint",{attachmentClass:Q,type:T,IsInline:N,isError:!0,message:k.message},{isCore:!0}),V={item:this.currentDownloadItem,reason:"S/MIME: Unsupported reference attachment"===k.message?1:0},this.downloadFailures.push(V),[3,17];case 16:return this.processNextAttachment(),[7];case 17:return[3,19];case 18:this.finishProcess(),B.label=19;case 19:return[2]}var R,U}))}))},t.prototype.finishProcess=function(){var t=this.currentDownloadItem&&this.currentDownloadItem.attachmentState?this.currentDownloadItem.attachmentState.attachmentId:null;i.g.info("Attachment: SmimeAttachmentQueueManager: finishProcess"),this.isInProgress=!1,this.currentDownloadItem=null,this.onFinish(t),this.datapoint.end(),this.datapoint=null,this.downloadFailures.length&&this.removeFromAttachmentWellAndShowError(this.downloadFailures),this.downloadFailures=[]},t.prototype.removeRelatedItemFromDownloadQueue=function(t,e){for(var n=0;n<e.length;n++){e[n].attachmentState.attachmentId===t.attachmentId&&e.splice(n,1)}},t.prototype.removeFromAttachmentWellAndShowError=function(t){var e=this,n=[],a=[];t.map((function(t){var r=t.item.attachment&&t.item.attachment.model.Name;1===t.reason?n.push(r):0===t.reason&&a.push(r),Object(b.a)(e.attachmentWellViewState,t.item.attachmentState)})),n.length>0&&Object(c.a)(this.infoBar,"ErrorSmimeHasCloudOrUriAttachments",[Object(r.c)(Object(r.b)(O.a),n.join(", "))]),a.length>3?Object(c.a)(this.infoBar,"ErrorAttachmentDownloadFailedMultipleFiles",[Object(r.c)(Object(r.b)(S.b),a.length)]):a.length>0&&Object(c.a)(this.infoBar,"ErrorAttachmentDownloadFailed",[Object(r.c)(Object(r.b)(S.a),a.join(", "))])},t.prototype.getAttachmentId=function(t,e){var n,a=t,r=a.AttachmentIdToAttach&&Object(p.a)({Id:a.AttachmentIdToAttach});switch(t.__type){case P.b:case P.c:n=r;break;default:n=r||t.AttachmentId}return Object(s.__assign)(Object(s.__assign)({},n),{mailboxInfo:e.mailboxInfo})},t.prototype.getItemId=function(t){var e=t;return e.Item?e.Item.ItemId:e.ItemId},t}();n.d(e,"a",(function(){return M})),n.d(e,"b",(function(){return k}));var x={};function M(t,e,n,i,s){return e?N(t,e,n).enqueueSmimeAttachmentDownload(i,s):(Object(o.a)(n),Object(c.a)(n,"WarningFilesCanNotBeAttachedGenericError",[Object(r.b)(a.a)]),[])}function k(t,e,n,a,r){N(t,n,a).deleteSmimeAttachment(e,r)}function N(t,e,n){var a=x[e.Id];return a||(i.g.info("Creating SmimeAttachmentQueueManager"),a=function(t,e,n){return new F(t,e,n)}(t,e,n),x[e.Id]=a,a.onFinishPromise.then((function(){i.g.info("Deleting SmimeAttachmentQueueManager"),delete x[e.Id]}))),a}}}]);
//# sourceMappingURL=owa.MailBoot~Attachments~smime.js.map
self.scriptsLoaded['owa.MailBoot~Attachments~smime.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~Attachments~smime.js'] = (new Date()).getTime();