self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttachmentModelStore~filesView.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[212],{1744:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(295),a=n(388);function i(e){if("ArchiveMailbox"==e.type)return Object(r.a)();var t=e.userIdentity&&Object(a.r)(e.userIdentity),n="GroupMailbox"===e.type;return t&&!n?Object(r.b)(e.mailboxSmtpAddress)+e.userIdentity:"UserMailbox"===e.type?Object(r.a)():e.mailboxSmtpAddress}},1746:function(e,t,n){"use strict";var r=n(388),a=n(0),i={};function o(e){return i[e]}function c(e,t){var n=i[e];i[e]=Object(a.__assign)(Object(a.__assign)({},n),t)}var u=n(96),s=n(29);var d=n(269),l=n(59),b=n(670),f=n(1347),v=n(1346);function h(e){return Object(a.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(a.__generator)(this,(function(r){switch(r.label){case 0:return(t={}).headers=new Headers,[4,Object(f.a)(e)];case 1:return n=r.sent(),Object(v.b)(t.headers,n),[2,t]}}))}))}var O=Object(b.b)({timeBetweenRetryInMS:function(){return 3e4}});function j(e,t){t=t<1?1:t,setInterval((function(){!function(e){Object(a.__awaiter)(this,void 0,void 0,(function(){var t,n,i,u,b,f,v=this;return Object(a.__generator)(this,(function(j){switch(j.label){case 0:if(t=function(){return Object(a.__awaiter)(v,void 0,void 0,(function(){var t,n;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t={},Object(r.r)(e.userIdentity)?[4,h(e.userIdentity)]:[3,2];case 1:t=a.sent(),a.label=2;case 2:return[2,(i=t,Object(s.a)("GetAttachmentDownloadToken",{},i))];case 3:throw n=a.sent(),l.g.warn("Unable to get the download token "+n),n.networkError=!0,n;case 4:return[2]}var i}))}))},null==(n=o(e.userIdentity))?void 0:n.isRefreshingDownloadToken)return[3,4];c(e.userIdentity,{isRefreshingDownloadToken:!0}),i=0,u=O((function(){return Object(a.__awaiter)(v,void 0,void 0,(function(){var n;return Object(a.__generator)(this,(function(r){switch(r.label){case 0:return i++,[4,t()];case 1:return n=r.sent(),l.g.info("update new token"),c(e.userIdentity,{downloadToken:n,isRefreshingDownloadToken:!1}),[2]}}))}))})).retriableFunc,b=new d.b("AttachmentRefreshDownloadToken"),j.label=1;case 1:return j.trys.push([1,3,,4]),[4,u()];case 2:return j.sent(),b.addCustomData([i]),b.end(),[3,4];case 3:return f=j.sent(),l.g.warn("Retry to refresh token failed: "+f),b.addCustomData([i]),b.endWithError("ServerError",f),c(e.userIdentity,{isRefreshingDownloadToken:!1}),[3,4];case 4:return[2]}}))}))}(e)}),6e4*t)}var m=n(270);function w(e){var t=Object(r.j)(null==e?void 0:e.userIdentity),n=o(null==e?void 0:e.userIdentity);if((null==n?void 0:n.downloadToken)&&(null==n?void 0:n.downloadUrlBase))return n;switch(t){case null:case"Outlook":!function(e){var t=Object(r.r)(e.userIdentity)?Object(u.i)(e.userIdentity):Object(u.h)(),n=null==t?void 0:t.ApplicationSettings;if(n){var a=n.DownloadUrlBase;c(e.userIdentity,{downloadUrlBase:a,downloadToken:n.FirstDownloadToken}),a&&j(e,n.DownloadTokenRefreshMinutes)}}(e);break;case"Google":case"ICloud":break;default:Object(m.a)(t)}var a=o(e.userIdentity);return a||(Object(d.p)("FilesUrlDataNotFound",{accountProviderType:t}),l.g.warn("Unable to get the url data")),a}function p(e){if(!e)return null;var t=w(e);return null==t?void 0:t.downloadToken}n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return p}))},1923:function(e,t,n){"use strict";var r=n(1928);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b}));var a=n(1746);n.d(t,"c",(function(){return a.a}));var i=n(1744);n.d(t,"d",(function(){return i.a}))},1928:function(e,t,n){"use strict";var r=n(270),a=n(12),i=n(43),o="/owa/",c="service.svc/s/GetFileAttachment?id={0}",u="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}",s="service.svc/s/GetAttachmentThumbnail?id={0}&thumbnailType=2",d="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}&isImagePreview=True",l="service.svc/s/GetAttachmentThumbnail?id={0}",b="pdfprint.aspx?id={0}",f="pdfprint.aspx?id={0}&location={1}",v=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd",".tiff",".tif"];var h=n(320),O=n(57),j=n(2),m=n(27),w=n(1746),p=n(1744);function I(e,t,n,r,c){if(void 0===r&&(r=!1),void 0===c&&(c=null),!e||!e.Id||!e.mailboxInfo)return null;var u=Object(w.b)(e.mailboxInfo),s=null==u?void 0:u.downloadUrlBase,d=Object(p.a)(e.mailboxInfo);if(c=c||Object(a.c)(t,encodeURIComponent(e.Id)),!s||r&&"Firefox"===Object(O.a)().browser){var l=o+c+"&X-OWA-CANARY="+Object(i.a)();return Object(m.a)(l)}var b="{0}{1}/{2}";Object(h.a)()&&(b+="&isc=1");var f=Object(a.c)(b,s,d,c);return n&&(f+="&token="+(null==u?void 0:u.downloadToken),f+="&X-OWA-CANARY="+Object(i.a)()),Object(O.i)()||(f+="&owa="+window.location.hostname,f+="&scriptVer="+Object(j.n)()||!1),f}function g(e,t,n,c,s,l,b,h,O){var j;switch(void 0===s&&(s=0),void 0===l&&(l=0),void 0===b&&(b=!0),void 0===h&&(h=null),void 0===O&&(O=null),n){case 0:j=u;break;case 3:j=f;break;case 1:if(!function(e){if(!e)return!1;var t=null,n=e.lastIndexOf(".");return n>0&&(t=e.substr(n).toLowerCase()),!!t&&v.indexOf(t.toLowerCase())>=0}(h))return null;j=d;break;default:Object(r.a)(n)}var w=c?l:s;!w&&s&&(w=s);var p=Object(a.c)("{0}&permissionLevel={1}",Object(a.c)(j,encodeURIComponent(e.Id),encodeURIComponent(t)),w),g=I(e,j,!0,3===n,p);if(g)return g;var _=Object(a.c)("{0}{1}{2}",o,O,p);b&&(_=_+"&X-OWA-CANARY="+Object(i.a)());return Object(m.a)(_)}function _(e,t,n,i){var o;switch(void 0===n&&(n=!1),void 0===i&&(i=!0),t){case 0:o=c;break;case 1:o=s;break;case 2:o=l;break;case 3:o=b;break;default:return Object(r.a)(t)}if(!Object(a.f)(o)){var u=I(e,o,i,3===t);return Object(a.c)("{0}{1}{2}",u,n?"&isDownload=true":"","&animation=true")}return null}n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return _}))},2247:function(e,t,n){"use strict";var r=n(270),a=n(1923),i=n(43),o=n(2518);function c(e,t,n,i,c){var u;void 0===c&&(c=!0);var s=t,d=s.Name,l=s.OriginalPermissionType,b=s.PermissionType,f=Object(o.a)(t),v="GroupMailbox"===(null===(u=null==e?void 0:e.mailboxInfo)||void 0===u?void 0:u.type)?e.mailboxInfo.mailboxSmtpAddress+"/":null;switch(n){case 0:case 3:return a.b(e,f,n,i,b,l,c,d,v);case 1:return t.AttachmentPreviewUrl?t.AttachmentPreviewUrl:a.b(e,f,1,i,b,l,c,d,v);case 2:return t.AttachmentThumbnailUrl;default:return Object(r.a)(n)}}function u(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),a.a(e,t,n,r)}function s(e,t,n,r,o){void 0===o&&(o=!1);var s=n?c(e,t,1,r,!1):u(e,1,o,!1);if(n)return{url:s,init:{credentials:"include"}};var d=Object(a.c)(e.mailboxInfo),l=new Headers;return l.set("X-Token",d),l.set("X-OWA-CANARY",Object(i.a)()),{url:s,init:{headers:l}}}function d(e,t,n,r,a,i){return void 0===i&&(i=!1),r?c(e,t,n,a):u(e,n,i)}n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return s}))},4678:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(3),i=Object(a.action)("checkPendingAttachmentOperation",(function(e,t,n,r,a){return{attachmentId:e,itemId:t,operationId:n,operationType:r,completeHandler:a}}));function o(e){return Object(r.__assign)({__type:"CheckPendingAttachmentOperationRequest:#Exchange"},e)}var c=n(29);function u(e,t,n,r,a){var i,u,s=function(e,t,n,r){return o({ewsAttachmentId:e,itemId:t,operationId:n,operationType:r})}(e,t,n,r);return u=a,void 0===(i=s)||i.__type||(i=o(i)),Object(c.a)("CheckPendingAttachmentOperation",i,u)}var s=n(59),d=n(440),l=(Object(a.orchestrator)(i,(function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var t,n,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=e.itemId?e.itemId.mailboxInfo:e.attachmentId.mailboxInfo,[4,u(e.attachmentId?e.attachmentId.Id:null,e.itemId?e.itemId.Id:null,e.operationId,e.operationType,Object(d.a)(t))];case 1:return n=r.sent(),e.completeHandler(n),[3,3];case 2:return a=r.sent(),s.g.warn("checkPendingAttachmentOperationAction is failing with error: "+a),[3,3];case 3:return[2]}}))}))})),n(2368)),b=n(1379),f=n(1874),v=n(7292);Object(a.orchestrator)(f.n,(function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return"object"!=typeof e.id?[3,2]:(t=Object(b.a)(e.id))?(n=t.model,[4,Object(v.a)([e.id],n.PermissionType)]):[3,2];case 1:r.sent(),Object(l.a)(t.id),r.label=2;case 2:return[2]}}))}))}));var h=n(5599),O=n(285),j=Object(O.action)("setPreviewImageUrl")((function(e,t){Object(b.a)(e).previewImage.url=t})),m=n(8226),w=n(6991),p=n(2007),I=n(5381),g=n(1780),_=n(2247);function A(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(I.a)(e)];case 1:if(null==(t=n.sent()))throw new Error("URL not available");return"2",[2,t+"2"]}}))}))}var y=Object(O.action)("refreshPreviewImageUrl")((function(e,t,n){return void 0===n&&(n=!1),Object(r.__awaiter)(this,void 0,void 0,(function(){var a,i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return a=Object(b.a)(e),Object(g.b)(a.model)&&a.model.ProviderType===p.e?[4,A(a.model)]:[3,2];case 1:return i=r.sent(),j(e,i),[3,3];case 2:Object(g.b)(a.model)&&a.model.ProviderType!==p.h&&a.model.ProviderType!==p.i||(o=Object(_.a)(e,a.model,1,1===a.type,t,n),j(e,o)),r.label=3;case 3:return[2]}}))}))})),k=n(6165),T=n(9249),x=Object(O.action)("setAttachmentInfo")((function(e,t){Object(b.a)(e).info=t}));n.d(t,"addAndInitializeAttachments",(function(){return h.a})),n.d(t,"setPreviewImageUrl",(function(){return j})),n.d(t,"refreshDownloadUrl",(function(){return m.a})),n.d(t,"refreshThumbnailImageUrl",(function(){return w.a})),n.d(t,"refreshPreviewImageUrl",(function(){return y})),n.d(t,"getAttachment",(function(){return b.a})),n.d(t,"checkPendingAttachmentOperation",(function(){return i})),n.d(t,"shouldShowImageView",(function(){return k.a})),n.d(t,"createAttachmentInfo",(function(){return T.a})),n.d(t,"setAttachmentInfo",(function(){return x}))}}]);
//# sourceMappingURL=owa.MailBoot~AttachmentModelStore~filesView.js.map
self.scriptsLoaded['owa.MailBoot~AttachmentModelStore~filesView.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttachmentModelStore~filesView.js'] = (new Date()).getTime();