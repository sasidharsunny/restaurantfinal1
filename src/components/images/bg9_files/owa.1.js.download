self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.1.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[1],{192:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,i=!1;function o(t){r--,delete e[t]}this.put=function(t,n,i,c){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==c&&"function"!=typeof c)throw new Error("Cache timeout callback must be a function");var u=e[t];u?clearTimeout(u.timeout):r++;var s={value:n,expire:i+Date.now()};return isNaN(s.expire)||(s.timeout=setTimeout(function(){o(t),c&&c(t,n)}.bind(this),i)),e[t]=s,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&o(t),n},this.clear=function(){for(var o in e)clearTimeout(e[o].timeout);r=0,e=Object.create(null),i&&(t=0,n=0)},this.get=function(o){var c=e[o];if(void 0!==c){if(isNaN(c.expire)||c.expire>=Date.now())return i&&t++,c.value;i&&n++,r--,delete e[o]}else i&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),i=Date.now(),o=n&&n.skipDuplicates;for(var c in r)if(r.hasOwnProperty(c)){if(o)if(e[c])continue;var u=r[c],s=u.expire-i;if(s<=0){this.del(c);continue}s=s>0?s:void 0,this.put(c,u.value,s)}return this.size()}}e.exports=new r,e.exports.Cache=r},318:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a}));var r=n(192),i=null,o=3e4;function c(){return null==i&&(i=new r.Cache),i}function u(e){return c().get(e)}function s(e){return c().del(e)}function a(e,t){c().put(e,t,o)}},455:function(e,t,n){"use strict";var r=n(0),i=n(192),o=n(297),c=n(349);function u(e){return Object(r.__assign)({__type:"TokenRequest:#Exchange"},e)}var s=n(109),a=n(29);function l(e,t){return void 0===e||e.__type||(e=u(e)),Object(a.a)("GetAccessTokenforResource",e,t)}var d=n(116),f=n(190),h="OWA_GetAccessTokenForResource";function v(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(d.a)()];case 1:return(i=r.sent())&&e==Object(f.a)()?[2,{AccessToken:i}]:(o={isUserActivity:!1,datapoint:{customData:{Scenario:h,Resource_Url:e,Retry_attempt:t,Request_Id:n},headersCustomData:function(e){return{TokenResultDetails:e.get("x-tokenresult")||""}},jsonCustomData:function(e){var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}}},returnFullResponseOnSuccess:!0},[4,l(u({Resource:e,UserToken:i}),o)]);case 2:return[4,r.sent().json()];case 3:return[2,r.sent()]}}))}))}function b(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return t<1?[2,Promise.reject()]:[2,v(e,t,i).catch((function(r){return Object(s.a)(n).then((function(){return b(e,t-1,2*n,i)}))}))]}))}))}var p,_=n(83),O=n(444),m=3,k=500;function g(e,t){return new Promise((function(n,r){(null==p&&(p=new O.a(m,w,k)),p).add({onFulfilled:n,onRejected:r,resource:e,requestId:t})}))}function w(e){return E(e.resource,e.requestId).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var j=n(318),A=n(74),T=n(362);n.d(t,"b",(function(){return R})),n.d(t,"c",(function(){return S})),n.d(t,"a",(function(){return E}));var y=1,x=8e3,C=3,I=1500,D=null;function R(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=q(U(),e),t=t||Object(T.a)(),null!=n?[3,2]:[4,E(e,t)];case 1:n=r.sent(),r.label=2;case 2:return[2,null!=n?n.AccessToken:void 0]}}))}))}function S(e,t){t=t||Object(T.a)();var n=q(U(),e);if(n)return[n.AccessToken,void 0];if(Object(_.i)("auth-getAccessTokenQueueEnabled")){var r=Object(j.a)(e),i=void 0;return r?i=r:(i=g(e,t),Object(j.b)(e,i)),[void 0,i.then((function(t){return Object(j.c)(e),t.AccessToken})).catch((function(n){Object(j.c)(e),Object(A.h)(h,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))]}return[void 0,E(e,t).then((function(e){return e.AccessToken}))]}function E(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return Object(_.i)("auth-getAccessTokenQueueEnabled")?[4,b(e,C,I,t)]:[3,2];case 1:return i=r.sent(),[3,4];case 2:return[4,v(e,C,t)];case 3:i=r.sent(),r.label=4;case 4:return null!=(n=i)&&0==n.TokenResultCode&&null!=n.AccessTokenExpiry&&(n.ExpiresIn&&n.ExpiresIn>0&&(n.AccessTokenExpiry=Object(c.a)(Date.now(),n.ExpiresIn).toISOString()),(o=new Date(n.AccessTokenExpiry).getTime()-Date.now()-x)>0&&U().put(e,n,o,(function(e,n){E(e,t).catch((function(n){Object(A.h)(h,{category:"Cache_Expired",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))}))),[2,n]}}))}))}function q(e,t){var n=e.get(t),r=void 0;(null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken&&(Object(o.a)(new Date(n.AccessTokenExpiry),-y)>new Date(Date.now())&&(r=n));return r}function U(){return null==D&&(D=new i.Cache),D}},469:function(e,t,n){"use strict";n.r(t);var r=n(455),i=n(0),o=n(192),c=n(317),u=n(107),s=n(349),a=n(74),l="OWA_GetDelegationAccessToken",d={};function f(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(i.__generator)(this,(function(r){switch(r.label){case 0:t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,h(e,window,t)];case 2:return n=r.sent(),[3,5];case 3:return r.sent(),n.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(t,window),[7];case 5:return[2,n]}}))}))}function h(e,t,n){return Object(i.__awaiter)(this,void 0,void 0,(function(){var r,o;return Object(i.__generator)(this,(function(i){return r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+c.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((o=t.document.createElement("iframe")).src=r.toString(),o.style.display="none",o.id=n,t.document.body.appendChild(o),[2,new Promise((function(r,i){d[n]=function(n){var u={};try{o.contentWindow&&o.contentWindow.location.host==t.location.host&&(u=function(e,t){var n=c.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(s.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(a.h)(l+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(a.h)(l+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(o.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(a.h)(l+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),u.TokenResultCode=2,i(u)}r(u)},o.addEventListener("load",d[n],!1)}))])}))}))}var v,b=n(83),p=n(318),_=n(444),O=3,m=1500;function k(e){return new Promise((function(t,n){(null==v&&(v=new _.a(O,g,m)),v).add({onFulfilled:t,onRejected:n,options:e})}))}function g(e){return f(e.options).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var w=n(190),j=n(362),A=null,T="OWA_GetDelegationAccessToken",y="https://login.live.com/oauth20_authorize.srf",x="/owa/auth/dt.aspx",C="292841";function I(e,t){return Object(i.__awaiter)(this,void 0,void 0,(function(){var n,r,o,s,l;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:n={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:t||Object(j.a)()},i.label=1;case 1:return i.trys.push([1,7,,8]),Object(b.i)("auth-disableGetAuthenticationCall")?[4,D(E(n))]:[3,3];case 2:return r=i.sent(),[3,6];case 3:return[4,Object(u.a)({})];case 4:return 0!=(o=i.sent()).ResultCode||null==o.ImplicitGrantAuthorizationUrl||""==o.ImplicitGrantAuthorizationUrl?(Object(a.h)(T+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:n.requestId}),[2,r]):(s=c.parse(o.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&s.redirect_uri?(n.client_id=s.client_id,n.authorization_uri=o.ImplicitGrantAuthorizationUrl.split("?")[0],n.redirect_uri=s.redirect_uri,[4,D(n)]):[3,6];case 5:r=i.sent(),i.label=6;case 6:return[2,r];case 7:return l=i.sent(),Object(a.h)(T+" GetDelegationToken Operation failed ",{err:l.toString(),message:l.message,stk:l.stack||"",scope:e,requestId:n.requestId}),[2,r];case 8:return[2]}}))}))}function D(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=e.client_id+e.scope,(null==(n=function(e,t){var n=e.get(t),r=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(r=n)}return r}(S(),t))?void 0:n.AccessToken)?[2,n.AccessToken]:[3,1];case 1:return Object(b.i)("auth-getDelegationTokenQueueEnabled")?(r=Object(p.a)(t),o=void 0,r?o=r:(o=k(e),Object(p.b)(t,o)),[2,o.then((function(e){return R(t,e),Object(p.c)(t),e.AccessToken})).catch((function(n){Object(p.c)(t),Object(a.h)(T,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",scope:e.scope,requestId:e.requestId})}))]):[3,2];case 2:return[4,f(e)];case 3:return n=i.sent(),R(t,n),[2,0==n.TokenResultCode?n.AccessToken:void 0]}}))}))}function R(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&S().put(e,t,n)}}function S(){return null==A&&(A=new o.Cache),A}function E(e){return e.redirect_uri=Object(w.a)()+x,e.authorization_uri=y,e.client_id=C,e}var q=n(5),U=n(429);var F=!1;function N(){var e;F||(e=Object(U.a)("/owa"),Object(q.b)({baseUrl:e}),F=!0)}var P={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function z(e,t,n,r,i){n?e.acquireTokenPopup(t,null,n,i):e.acquireToken(t,(function(n,o){n&&n.indexOf(P.NoPreAuth)>=0&&r?e.acquireTokenPopup(t,null,null,i):i(n,o)}))}var G=n(77),W=new G.c((function(){return n.e(455).then(n.bind(null,16993))})),J=new G.a(W,(function(e){return e.createAdalAuthenticationContext}));function L(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return e="https://login.microsoftonline.com/",[4,Object(u.a)({})];case 1:return 0===(null==(t=i.sent())?void 0:t.ResultCode)&&(null==t?void 0:t.AuthenticationUrl)&&(r=t.AuthenticationUrl.split("/"),n=r[0]+"//"+r[2]+"/"),[2,n||e]}}))}))}var B=function(e,t,n,r,i){return function(o,c){o||!c?i(o,null):(e.getCachedUser(),z(e,t,n,r,i))}},Q="adalIdTokenFrame";function M(e,t,n,r,i){e.config.displayCall=function(o){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(o),window.detectUserCachedCallback=B(e,t,n,r,i),function(e,t){e._addAdalFrame(Q).src="about:blank",e._loadFrame(t+"&prompt=none",Q)}(e,o)},e.login()}var $=n(30);function H(e,t,n,r,o,c){var u,s;return Object(i.__awaiter)(this,void 0,void 0,(function(){var a,l,d,f,h;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return[4,L()];case 1:return a=i.sent(),[4,J.importAndExecute(a,e,t)];case 2:return l=i.sent(),d=Object($.a)(),f=null===(u=d.SessionSettings)||void 0===u?void 0:u.UserPrincipalName,h=null===(s=d.SessionSettings)||void 0===s?void 0:s.UserEmailAddress,l._user={profile:{upn:f||h}},l.getCachedUser()?z(l,n,r,o,c):M(l,n,r,o,c),[2]}}))}))}n.d(t,"getAccessTokenforResource",(function(){return r.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return r.c})),n.d(t,"getDelegationTokenForOwa",(function(){return I})),n.d(t,"bootstrap",(function(){return N})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return H})),n.d(t,"AdalErrorCode",(function(){return P}))}}]);
//# sourceMappingURL=owa.1.js.map
self.scriptsLoaded['owa.1.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.1.js'] = (new Date()).getTime();